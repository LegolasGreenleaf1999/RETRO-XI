{%load static%}
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add New Offer â€“ Admin</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Manrope", sans-serif;
      background-color: #f6f8f7;
    }

    .modal-backdrop-custom {
      background-color: rgba(20, 30, 23, 0.6);
      backdrop-filter: blur(4px);
    }

    .offer-card {
      border: 2px solid #d4e3d9;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .offer-radio:checked + .offer-card {
      border-color: #184e2a;
      background-color: rgba(24, 78, 42, 0.05);
    }

    .text-primary-custom {
      color: #184e2a;
    }

    .bg-primary-custom {
      background-color: #184e2a;
    }

    .chip {
      background: rgba(24, 78, 42, 0.1);
      color: #184e2a;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
  </style>
</head>

<body>
<form method="post">
  {%csrf_token%}
<!-- Modal -->
<div class="modal fade show d-block" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg border-0 rounded-4">

      <!-- Header -->
      <div class="modal-header px-4 py-3">
        <div>
          <h4 class="fw-bold mb-1">Create New Promotion</h4>
          <p class="text-muted mb-0 small">
            Follow the steps below to define and activate a new offer.
          </p>
        </div>
        <a class="btn-close" href="{%url 'admin_offers'%}"></a>
      </div>

      <!-- Body -->
      <div class="modal-body px-4 py-4">
        <h6 class="fw-bold mb-3">Step 1: Select offer type</h6>
        <div class="row g-3 mb-5">
          <div class="col md-4">
            <label class="w-100">
              <input type="radio" name="scope" value="product" class="d-none offer-radio" checked>
              <div class="offer-card rounded-3 p-3 h-100">
                <span class="material-symbols-outlined fs-3">app_registration</span>
                <h6 class="fw-bold mt-2">Product Offer</h6>
                <p class="text-muted small mb-0">Apply to a specific jersey</p>
              </div>
            </label>
          </div>
          <div class="col md-4">
            <label class="w-100">
              <input type="radio" name="scope" value="category" class="d-none offer-radio">
              <div class="offer-card rounded-3 p-3 h-100">
                <span class="material-symbols-outlined fs-3">category</span>
                <h6 class="fw-bold mt-2">Category Offer</h6>
                <p class="text-muted small mb-0">Apply to a collection</p>
              </div>
            </label>
          </div>
          <div class="col md-4">
            <label class="w-100">
              <input type="radio" name="scope" value="referral" class="d-none offer-radio">
              <div class="offer-card rounded-3 p-3 h-100">
                <span class="material-symbols-outlined fs-3">group_add</span>
                <h6 class="fw-bold mt-2">Referral Offer</h6>
                <p class="text-muted small mb-0">Reward referrals</p>
              </div>
            </label>
          </div>
        </div>

        <!-- Offer Details -->
        <h6 class="fw-bold mb-3">Step 2: Offer Details</h6>

        <div class="row g-4">
          <div class="col-md-6">
            <div class="mb-3">
            <label class="form-label fw-bold">Offer Name</label>
            {{form.name}}
            </div>
            <div class="mb-3">
            <label class="form-label fw-bold mt-3">Description</label>
            {{form.description}}
            </div>
          </div>

          <div class="col-md-6">
            <div class="row g-3">
              <div class="col-6">
                <label class="form-label fw-bold">Discount Type</label>
                {{form.discount_type}}
              </div>

              <div class="col-6">
                <label class="form-label fw-bold">Value</label>
                {{form.discount_value}}
              </div>
            </div>

            <div class="form-check form-switch mt-4">
              {{form.is_active}}
              <label class="form-check-label fw-bold">Active immediately</label>
            </div>
          </div>
        </div>

        <!-- Products -->
        <div class="mt-4" id="product-fields">
          <label class="form-label fw-bold">Select Product</label>
          {{form.product}}
        </div>
        <div class="mt-4 d-none" id="category-fields">
          <label class="form-label fw-bold">Select Category</label>
          {{form.category}}
        </div>
        <div class="mt-4 d-none" id="referral-fields">
          <label class="form-label fw-bold">Referral Code</label>
          {{form.referral_code}}
        </div>
        <!-- Dates -->
        <div class="row g-3 mt-3">
          <div class="col-md-6">
            <label class="form-label fw-bold">Start Date</label>
            {{form.start_date}}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold">End Date</label>
            {{form.end_date}}
          </div>
        </div>
        {%if form.errors%}
        <div class="alert alert-danger mt-4">
          {{form.errors}}
        </div>
        {%endif%}
      </div>

      <!-- Footer -->
      <div class="modal-footer px-4 py-3">
        <a class="btn btn-outline-secondary" href="{%url 'admin_offers'%}">Cancel</a>
        <button type="submit" class="btn bg-primary-custom text-white fw-bold">
          <span class="material-symbols-outlined align-middle me-1">rocket_launch</span>
          Save Offer
        </button>
      </div>

    </div>
  </div>
</div>

</form>
<script>
  const radios = document.querySelectorAll('input[name="scope"]');
  const productFields = document.getElementById('product-fields');
  const categoryFields = document.getElementById('category-fields');
  const referralFields = document.getElementById('referral-fields');

  function toggleFields(value) {
    productFields.classList.add('d-none');
    categoryFields.classList.add('d-none');
    referralFields.classList.add('d-none');

    if (value === 'product') productFields.classList.remove('d-none');
    if (value === 'category') categoryFields.classList.remove('d-none');
    if (value === 'referral') referralFields.classList.remove('d-none');
  }

  radios.forEach(radio => {
    radio.addEventListener('change', e => toggleFields(e.target.value));
  });

  toggleFields('product'); // DEFAULT
</script>

</body>
</html>