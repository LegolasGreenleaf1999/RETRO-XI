{% extends 'admin/admin_base.html' %} 
{% load static %}
{% block content %}


<!-- MAIN CONTENT -->
<main class="flex-fill">

  <!-- HEADER -->
  <header class="bg-white border-bottom sticky-top px-4 py-3 d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-4 flex-grow-1">
      <h3 class="fw-bold mb-0">Offers</h3>
      <form method="get" class="input-group w-50">
        <span class="input-group-text bg-light border-0">
          <span class="icon">search</span>
        </span>
        <input type="text" name="q" value="search" class="form-control bg-light border-0" placeholder="Search offers...">
      </form>
    </div>

    <a class="btn btn-success fw-bold" href="{%url 'create_offer'%}">
      <span class="material-symbols-outlined me-1">add</span> Add New Offer
    </a>
  </header>

  <!-- CONTENT -->
  <div class="p-4">

    <!-- STATS -->
    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="card border-0 custom-shadow">
          <div class="card-body">
            <small class="text-muted">Total Offers</small>
            <h3 class="fw-bold">{{total_offers}}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 custom-shadow">
          <div class="card-body">
            <small class="text-success fw-bold">Active</small>
            <h3 class="fw-bold">{{active_offers}}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 custom-shadow">
          <div class="card-body">
            <small class="text-warning fw-bold">Scheduled</small>
            <h3 class="fw-bold">{{scheduled_offers}}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 custom-shadow">
          <div class="card-body">
            <small class="text-muted fw-bold">Expired</small>
            <h3 class="fw-bold">{{expired_offers}}</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- TABLE -->
    <div class="card border-0 custom-shadow">
      <div class="card-body p-0">
        <table class="table align-middle mb-0">
          <thead class="table-light text-uppercase small">
            <tr>
              <th>Offer Name</th>
              <th>Linked To</th>
              <th>Discount</th>
              <th>Validity</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {%for offer in offers%}
            <tr>
              <td>
                <strong>{{offer.name}}</strong><br>
                <small class="text-muted">{{offer.description}}</small>
              </td>
              <td>
                {%if offer.scope == 'product'%}
                {{offer.product}}
                {%elif offer.scope == 'category'%}
                {{offer.category}}
                {%else%}
                Referral
                {%endif%}
              </td>
              <td class="fw-bold text-success">
                {%if offer.discount_type == 'percentage'%}
                {{offer.discount_value}}% OFF 
                {%else%}
                Rs. {{offer.discount_value}}
                {%endif%}
              </td>
              <td>
                {{offer.start_date}}-{{offer.end_date|default:"No expiry"}}
              </td>
              <td>
                <span class="badge 
                {%if offer.status == 'active'%}bg-success 
                {%elif offer.status == 'scheduled'%}bg-warning text-dark
                {%else%}bg-secondary{%endif%}
                badge-dot">
                {{offer.status|title}}
              </span>
              </td>
              <td class="text-end">
                <div class="hover-actions">
                  <a class="btn btn-sm btn-success" href="{%url 'edit_offer' offer.id%}">Edit</a>
                  <a class="btn btn-sm btn-danger" href="{%url 'delete_offer' offer.id%}" onclick="return confirm('Delete this offer?')">Delete</a>
                </div>
              </td>
            </tr>
            {%empty%}
            <tr>
              <td colspan="6" class="text-center text-muted py-4">
                No offers found
              </td>
            </tr>
            {%endfor%}
          </tbody>
        </table>
      </div>

      <!-- PAGINATION -->
      <div class="d-flex justify-content-between align-items-center p-3 border-top">
        <small class="text-muted">Showing {{offers.start_index}}-{{offers.end_index}}</small>
        <div class="btn-group btn-group-sm">
          {%if offers.has_previous%}
          <a class="btn btn-outline-secondary" href="?page={{offers.previous_page_number}}">Previous</a>
          {%endif%}
          <span class="btn btn-success">{{offers.number}}</span>
          {%if offers.has_next%}
          <a class="btn btn-outline-secondary" href="?page={{offers.next_page_number}}">Next</a> 
          {%endif%}
        </div>
      </div>
    </div>

  </div>
</main>
{% endblock %}
