{% extends 'user/profile_base.html' %}
{% block profile_top %}{% endblock %}
{% block profile_content %}
  <!-- Main Content -->
  <main class="flex-grow-1 p-4 p-md-5">
    <div class="container-fluid">

      <!-- Heading -->
      <div class="mb-4">
        <h1 class="fw-black text-vintage-green">My Orders</h1>
        <p class="text-muted">Track your purchases and order history.</p>
      </div>

      <!-- Orders -->

      <!-- Order 1: Delivered -->
       {%for order in orders%}
      <div class="card order-card mb-4 p-3">
        <div class="d-flex justify-content-between flex-wrap gap-3 mb-3">
          <div class="d-flex gap-3">
            {%with first_item=order.item.first%} 
            {%if first_item%}
            <img src="{{first_item.product.main_img.url}}" class="rounded" width="80" height="80" />
            {%endif%}
            {%endwith%}
            <div>
              <h5 class="fw-bold mb-1">
                {%with first_item=order.item.first%}
                {{first_item.product.name}}
                {%endwith%}
              </h5>
              <small class="text-muted d-block">Order #{{order.id}}</small>
              <small class="text-muted">{{order.created_at|date:'F d, Y'}}</small>
            </div>
          </div>
          {%if order.status == 'delivered'%}
          <span class="badge badge-delivered px-3 py-2 rounded-pill">Delivered</span>
          {%elif order.statu == 'shipped'%}
          <span class="badge badge-shipped px-3 py-2 rounded-pill">Shipped</span>
          {%elif order.status == 'cancelled'%}
          <span class="badge badge-cancelled px-3 py-2 rounded-pill">Cancelled</span>
          {%else%}
          <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">{{order.status|title}}</span>
          {%endif%}
        </div>

        <div class="mb-3"> 
            <ul class="list-group list-group-flush">
                {%for item in order.item.all%}
                <li class="list-group-item d-flex justify-content-between">
                    <span>{{item.product.name}}x{{item.quantity}}</span> 
                    <span>Rs. {{item.price}}</span>
                </li> 
                {%endfor%}
            </ul>
        </div>

        <div class="d-flex justify-content-between align-items-center border-top pt-3 flex-wrap gap-3">
          <div>
            <strong class="fs-5">Rs. {{order.total}}</strong>
            <small class="text-muted"> 
                |{{order.delivery_type|title}} Delivery({{order.delivery_days}} days)
            </small>
          </div>
          <div class="d-flex gap-3">
            <a href="{%url 'orderdetails' order.id%}" class="fw-semibold text-vintage-green">View Details</a>
            {%if order.status == 'delivered'%}
            <a href="{%url 'download_invoice' order.id%}" class="fw-semibold text-vintage-green">Invoice</a>
            {%endif%}
          </div>
        </div> 
      </div>
      {%empty%}
      <p class="text-muted">You have not placed any orders yet</p>
      {%endfor%}

      <!-- Pagination -->
      <nav class="d-flex justify-content-center mt-4">
        <ul class="pagination">
            {%if orders.has_previous%}
          <li class="page-item"><a class="page-link" href="?page={{orders.previous_page_number}}">‹</a></li>
          {%endif%} 
          {%for num in orders.paginator.page_range%}
          {%if orders.number == num%}
          <li class="page-item active"><span class="page-link">{{num}}</span></li> 
          {%else%}    
          <li class="page-item"><a class="page-link" href="?page={{num}}">{{num}}</a></li>
          {%endif%}
          {%endfor%}
          {%if orders.has_next%}
          <li class="page-item"><a class="page-link" href="?page={{orders.next_page_number}}">›</a></li> 
          {%endif%}
        </ul>
      </nav>

    </div>
  </main>
{% endblock %}